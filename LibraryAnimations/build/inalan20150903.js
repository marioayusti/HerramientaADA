/*
*
* Copyright (c) 2015- Ladislav Vegh, Komarno, Slovakia
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*
*/
var inalan=inalan||{};inalan.Stage=function(canvasId){document.onselectstart=function(){return false};this.canvas=document.getElementById(canvasId);this.canvas.parent=this;this.ctx=this.canvas.getContext("2d");this.visuItems={};this.vars={};this.controller=new inalan.Controller();this.controller.x=30;this.controller.y=this.ctx.canvas.height-35;this.controller.ctx=this.ctx;this.canvas.addEventListener("mousemove",this.stageMouseMoveEvent);this.canvas.addEventListener("mousedown",this.stageMouseDownEvent);this.canvas.addEventListener("mouseout",this.stageMouseUpOrOutEvent);this.canvas.addEventListener("mouseup",this.stageMouseUpOrOutEvent);var self=this;this.fps=24;this.render=function(evt){self.ctx.clearRect(0,0,self.canvas.width,self.canvas.height);self.controller.render();for(var index in self.visuItems){if(self.visuItems.hasOwnProperty(index)){self.visuItems[index].render()}}for(var index in self.visuItems){if(self.visuItems.hasOwnProperty(index)){if(self.visuItems[index] instanceof inalan.VisuVariable||self.visuItems[index] instanceof inalan.VisuArray){self.visuItems[index].renderCopy()}}}if(self.showArrow.length>0){self.ctx.fillStyle="#055";self.ctx.globalAlpha=0.1;for(var i=0;i<self.showArrow.length/4;i++){var angle=Math.atan2(self.showArrow[i*4+3]-self.showArrow[i*4+1],self.showArrow[i*4+2]-self.showArrow[i*4]);var length=Math.sqrt(Math.pow(self.showArrow[i*4]-self.showArrow[i*4+2],2)+Math.pow(self.showArrow[i*4+1]-self.showArrow[i*4+3],2))+1;self.ctx.save();self.ctx.translate(self.showArrow[i*4+0],self.showArrow[i*4+1]);self.ctx.rotate(Math.PI+angle);self.ctx.beginPath();self.ctx.moveTo(0,-10);self.ctx.lineTo(0,+10);self.ctx.lineTo(-length+20,+10);self.ctx.lineTo(-length+20,+20);self.ctx.lineTo(-length,0);self.ctx.lineTo(-length+20,-20);self.ctx.lineTo(-length+20,-10);self.ctx.lineTo(0,-10);self.ctx.fill();self.ctx.restore()}self.ctx.globalAlpha=1}if(self.showBendedArrow.length>0){self.ctx.fillStyle="#055";self.ctx.globalAlpha=0.1;for(var i=0;i<self.showBendedArrow.length/2;i++){var x=self.showBendedArrow[i]-0.5;var y=self.showBendedArrow[i+1]+3;self.ctx.beginPath();self.ctx.moveTo(x-4,y-22.5);self.ctx.lineTo(x-4,y+1.5);self.ctx.lineTo(x+9,y-10.5);self.ctx.lineTo(x-4,y-22.5);self.ctx.moveTo(x,y-7.5);self.ctx.lineTo(x,y-15.5);self.ctx.arc(x,y-0.5,14,1.5*Math.PI,1.8*Math.PI,true);self.ctx.arc(x,y-0.5,8,1.85*Math.PI,1.5*Math.PI);self.ctx.fill()}self.ctx.globalAlpha=1}if(self.showDoubleArrow.length>0){self.ctx.fillStyle="#055";self.ctx.globalAlpha=0.1;for(var i=0;i<self.showDoubleArrow.length/2;i++){var x=self.showDoubleArrow[i]-0.5;var y=self.showDoubleArrow[i+1];self.ctx.beginPath();self.ctx.moveTo(x-4,y-22.5);self.ctx.lineTo(x-4,y+1.5);self.ctx.lineTo(x+9,y-10.5);self.ctx.lineTo(x-4,y-22.5);self.ctx.moveTo(x,y-7.5);self.ctx.lineTo(x,y-15.5);self.ctx.arc(x,y-0.5,14,1.5*Math.PI,0.8*Math.PI,true);self.ctx.arc(x,y-0.5,8,0.85*Math.PI,1.5*Math.PI);self.ctx.moveTo(x+4,y+225);self.ctx.lineTo(x+4,y-1.5);self.ctx.lineTo(x-9,y+10.5);self.ctx.lineTo(x+4,y+22.5);self.ctx.moveTo(x,y+7.5);self.ctx.lineTo(x,y+15.5);self.ctx.arc(x,y+0.5,14,0.5*Math.PI,1.8*Math.PI,true);self.ctx.arc(x,y+0.5,8,1.85*Math.PI,0.5*Math.PI);self.ctx.fill()}self.ctx.globalAlpha=1}};setInterval(this.render,1000/this.fps);this.showArrow=[];this.showBendedArrow=[];this.showDoubleArrow=[];this.animating=0;this.time=1000};inalan.Stage.prototype.stageMouseMoveEvent=function(evt){var canvasRect=evt.target.getBoundingClientRect();var mouseX=evt.clientX-canvasRect.left;var mouseY=evt.clientY-canvasRect.top;var stage=evt.target.parent;var dragging=false;if(evt.which==1){for(var i in stage.controller){if(stage.controller.hasOwnProperty(i)){var obj2=stage.controller[i];if(obj2 instanceof inalan.VisuScrollbar){if(obj2.dragging){var pos=obj2.min+(mouseX-(obj2.x-obj2.width/2+10))*(obj2.max-obj2.min+1)/(obj2.width-20);if(pos<obj2.min){pos=obj2.min}if(pos>obj2.max){pos=obj2.max}if(obj2.position!=pos){obj2.position=pos;obj2.onChange(pos)}dragging=true}}}}for(var index in stage.visuItems){if(stage.visuItems.hasOwnProperty(index)){var obj=stage.visuItems[index];if(obj instanceof inalan.VisuVariable){if(obj.dragging){if(obj.changeable){obj.value=obj.y-mouseY;dragging=true}else{obj.dragging=false}}}if(obj instanceof inalan.VisuArray){for(var i=0;i<obj.length;i++){if(obj[i].dragging){if(obj[i].changeable){obj[i].value=obj[i].y-mouseY;dragging=true}else{obj[i].dragging=false}}}}if(obj instanceof inalan.VisuScrollbar){if(obj.enabled&&obj.dragging){var pos=obj.min+(mouseX-(obj.x-obj.width/2+10))*(obj.max-obj.min+1)/(obj.width-20);if(pos<obj.min){pos=obj.min}if(pos>obj.max){pos=obj.max}if(obj.position!=pos){obj.position=pos;obj.onChange(pos)}dragging=true}}}}}if(!dragging){var mouseCursor="default";for(var i in stage.controller){if(stage.controller.hasOwnProperty(i)){var obj2=stage.controller[i];if(obj2 instanceof inalan.VisuButton){if(obj2.isOver(mouseX,mouseY)&&obj2.enabled){obj2.color=obj2.overColor;mouseCursor="pointer"}else{obj2.color=obj2.defaultColor}}if(obj2 instanceof inalan.VisuScrollbar){if(obj2.isOver(mouseX,mouseY)&&obj2.enabled){obj2.color=obj2.overColor;mouseCursor="pointer"}else{obj2.color=obj2.defaultColor}}}}for(var index in stage.visuItems){if(stage.visuItems.hasOwnProperty(index)){var obj=stage.visuItems[index];if(obj instanceof inalan.VisuVariable){if(obj.changeable&&obj.isOver(mouseX,mouseY)){mouseCursor="ns-resize"}}if(obj instanceof inalan.VisuArray){for(var i=0;i<obj.length;i++){if(obj[i].changeable&&obj[i].isOver(mouseX,mouseY)){mouseCursor="ns-resize"}}}if(obj instanceof inalan.VisuButton&&obj.enabled){if(obj.isOver(mouseX,mouseY)){obj.color=obj.overColor;mouseCursor="pointer"}else{obj.color=obj.defaultColor}}if(obj instanceof inalan.VisuScrollbar&&obj.enabled){if(obj.isOver(mouseX,mouseY)){obj.color=obj.overColor;mouseCursor="pointer"}else{obj.color=obj.defaultColor}}}}evt.target.style.cursor=mouseCursor}};inalan.Stage.prototype.stageMouseDownEvent=function(evt){if(evt.which==1){var canvasRect=evt.target.getBoundingClientRect();var mouseX=evt.clientX-canvasRect.left;var mouseY=evt.clientY-canvasRect.top;var stage=evt.target.parent;for(var i in stage.controller){if(stage.controller.hasOwnProperty(i)){var obj2=stage.controller[i];if(obj2 instanceof inalan.VisuButton){if(obj2.isOver(mouseX,mouseY)&&obj2.enabled){obj2.pressed=true}}if(obj2 instanceof inalan.VisuScrollbar){if(obj2.isOver(mouseX,mouseY)){obj2.dragging=true}}}}for(var index in stage.visuItems){if(stage.visuItems.hasOwnProperty(index)){var obj=stage.visuItems[index];if(obj instanceof inalan.VisuVariable){if(obj.changeable&&obj.isOver(mouseX,mouseY)){obj.dragging=true}}if(obj instanceof inalan.VisuArray){for(var i=0;i<obj.length;i++){if(obj[i].changeable&&obj[i].isOver(mouseX,mouseY)){obj[i].dragging=true}}}if(obj instanceof inalan.VisuButton&&obj.enabled){if(obj.isOver(mouseX,mouseY)){obj.pressed=true}}if(obj instanceof inalan.VisuScrollbar){if(obj.isOver(mouseX,mouseY)){obj.dragging=true}}}}}};inalan.Stage.prototype.stageMouseUpOrOutEvent=function(evt){if(evt.type=="mouseout"||evt.which==1){var canvasRect=evt.target.getBoundingClientRect();var mouseX=evt.clientX-canvasRect.left;var mouseY=evt.clientY-canvasRect.top;var stage=evt.target.parent;for(var i in stage.controller){if(stage.controller.hasOwnProperty(i)){var obj2=stage.controller[i];if(obj2 instanceof inalan.VisuButton){if(obj2.isOver(mouseX,mouseY)&&obj2.enabled&&obj2.pressed){obj2.onClickFnc()}obj2.pressed=false}if(obj2 instanceof inalan.VisuScrollbar){obj2.dragging=false}}}for(var index in stage.visuItems){if(stage.visuItems.hasOwnProperty(index)){var obj=stage.visuItems[index];if(obj instanceof inalan.VisuVariable){obj.dragging=false}if(obj instanceof inalan.VisuArray){for(var i=0;i<obj.length;i++){obj[i].dragging=false}}if(obj instanceof inalan.VisuButton){if(obj.isOver(mouseX,mouseY)&&obj.enabled&&obj.pressed){obj.onClickFnc()}obj.pressed=false}if(obj instanceof inalan.VisuScrollbar){obj.dragging=false}}}}};inalan.Stage.prototype.add=function(visuData,id){if(typeof(this.visuItems[id])!="undefined"){throw"- Can not add '"+id+"' to the stage, object with this ID already exists on the stage."}else{if(typeof(visuData.id)!="undefined"){throw"- This object was probably already added to the stage with ID: "+visuData.id+"."}}visuData.ctx=this.ctx;visuData.id=id;this.visuItems[id]=visuData};inalan.Stage.prototype.setSteps=function(stepFunctions){this.controller.setSteps(stepFunctions)};inalan.Stage.prototype.showAllButtons=function(){this.controller.showAllButtons()};inalan.Stage.prototype.get=function(id){return this.visuItems[id]};inalan.Stage.prototype.compare=function(firstObject,secondObject){firstObject.startComparing();if(firstObject!=secondObject){secondObject.startComparing()}var stage=this};inalan.Stage.prototype.copy=function(firstObject,secondObject){this.animating++;firstObject.changeable=false;secondObject.changeable=false;var stage=this;var distance=Math.sqrt(Math.pow(firstObject.x-secondObject.x,2)+Math.pow(firstObject.y-secondObject.y,2));var fps=this.fps;var time=distance*this.time/100;if(time>this.time){time=this.time}var frames=Math.floor(time*fps/1000);var intervalId=setInterval(function(){copyFnc()},1000/fps);var dx=(secondObject.x-firstObject.x)/frames;var dy=(secondObject.y-firstObject.y)/frames;var x=firstObject.x;var y=firstObject.y;var c1=firstObject.strokeColor;var c2=firstObject.fillColor;firstObject.startCopying();firstObject.setLightYellowColor();var copyFnc=function(){frames--;if(frames>0){firstObject.copyx+=dx;firstObject.copyy+=dy}else{if(frames<=0){firstObject.copyx=secondObject.x;firstObject.copyy=secondObject.y;secondObject.value=firstObject.value;secondObject.minValue=firstObject.minValue;secondObject.maxValue=firstObject.maxValue;secondObject.strokeColor=c1;secondObject.fillColor=c2;clearInterval(intervalId);stage.animating--;if(firstObject!=secondObject){stage.showArrow=stage.showArrow.concat([firstObject.x,firstObject.y-firstObject.value/2,secondObject.x,secondObject.y-secondObject.value/2])}else{stage.showBendedArrow=stage.showBendedArrow.concat([firstObject.x,firstObject.y-firstObject.value/2])}}}}};inalan.Stage.prototype.move=function(firstObject,secondObject){this.animating++;firstObject.changeable=false;secondObject.changeable=false;var stage=this;var distance=Math.sqrt(Math.pow(firstObject.x-secondObject.x,2)+Math.pow(firstObject.y-secondObject.y,2));var fps=this.fps;var time=distance*this.time/100;if(time>this.time){time=this.time}var frames=Math.floor(time*fps/1000);var intervalId=setInterval(function(){copyFnc()},1000/fps);var dx=(secondObject.x-firstObject.x)/frames;var dy=(secondObject.y-firstObject.y)/frames;var x=firstObject.x;var y=firstObject.y;var c1=firstObject.strokeColor;var c2=firstObject.fillColor;if(firstObject!=secondObject){firstObject.setGrayColor()}firstObject.startCopying();var copyFnc=function(){frames--;if(frames>0){firstObject.copyx+=dx;firstObject.copyy+=dy}else{if(frames<=0){firstObject.copyx=secondObject.x;firstObject.copyy=secondObject.y;secondObject.value=firstObject.value;secondObject.minValue=firstObject.minValue;secondObject.maxValue=firstObject.maxValue;secondObject.strokeColor=c1;secondObject.fillColor=c2;clearInterval(intervalId);stage.animating--;if(firstObject!=secondObject){stage.showArrow=stage.showArrow.concat([firstObject.x,firstObject.y-firstObject.value/2,secondObject.x,secondObject.y-secondObject.value/2])}else{stage.showBendedArrow=stage.showBendedArrow.concat([firstObject.x,firstObject.y-firstObject.value/2])}}}}};inalan.Stage.prototype.swap=function(firstObject,secondObject){this.animating++;firstObject.changeable=false;secondObject.changeable=false;var stage=this;var distance=Math.sqrt(Math.pow(firstObject.x-secondObject.x,2)+Math.pow(firstObject.y-secondObject.y,2));var fps=this.fps;var time=distance*this.time/100;if(time>this.time){time=this.time}var frames=Math.floor(time*fps/1000);var intervalId=setInterval(function(){copyFnc()},1000/fps);var dx=(secondObject.x-firstObject.x)/frames;var dy=(secondObject.y-firstObject.y)/frames;var x1=firstObject.x;var y1=firstObject.y;var x2=secondObject.x;var y2=secondObject.y;var c1=firstObject.strokeColor;var c2=firstObject.fillColor;firstObject.strokeColor=secondObject.strokeColor;firstObject.fillColor=secondObject.fillColor;secondObject.strokeColor=c1;secondObject.fillColor=c2;firstObject.startCopying();secondObject.startCopying();firstObject.setHiddenColor();secondObject.setHiddenColor();var copyFnc=function(){frames--;if(frames>0){firstObject.copyx+=dx;firstObject.copyy+=dy;secondObject.copyx-=dx;secondObject.copyy-=dy}else{if(frames<=0){var x=secondObject.value;secondObject.value=firstObject.value;firstObject.value=x;x=secondObject.minValue;secondObject.minValue=firstObject.minValue;firstObject.minValue=x;x=secondObject.maxValue;secondObject.maxValue=firstObject.maxValue;firstObject.maxValue=x;firstObject.copyx=firstObject.x;firstObject.copyy=firstObject.y;secondObject.copyx=secondObject.x;secondObject.copyy=secondObject.y;clearInterval(intervalId);stage.animating--;if(firstObject!=secondObject){if(secondObject.value>firstObject.value){var middle=secondObject.value/2;stage.showArrow=stage.showArrow.concat([firstObject.x,firstObject.y-middle-16,secondObject.x,secondObject.y-middle-16]);stage.showArrow=stage.showArrow.concat([secondObject.x,secondObject.y-middle+16,firstObject.x,firstObject.y-middle+16])}else{var middle=firstObject.value/2;stage.showArrow=stage.showArrow.concat([firstObject.x,firstObject.y-middle+16,secondObject.x,secondObject.y-middle+16]);stage.showArrow=stage.showArrow.concat([secondObject.x,secondObject.y-middle-16,firstObject.x,firstObject.y-middle-16])}}else{stage.showDoubleArrow=stage.showDoubleArrow.concat([firstObject.x,firstObject.y-firstObject.value/2])}}}}};inalan.Stage.prototype.sum=function(firstObject,secondObject){this.animating++;firstObject.changeable=false;secondObject.changeable=false;var stage=this;var distance=Math.sqrt(Math.pow(firstObject.x-secondObject.x,2)+Math.pow(firstObject.y-(secondObject.y-secondObject.value),2));var fps=this.fps;var time=distance*this.time/100;if(time>this.time){time=this.time}var frames=Math.floor(time*fps/1000);var intervalId=setInterval(function(){addFnc()},1000/fps);var dx=(secondObject.x-firstObject.x)/frames;var dy=(secondObject.y-firstObject.y-secondObject.value)/frames;var x=firstObject.x;var y=firstObject.y;firstObject.startCopying();firstObject.setLightYellowColor();var addFnc=function(){frames--;if(frames>0){firstObject.copyx+=dx;firstObject.copyy+=dy}else{if(frames<=0){firstObject.copyx=secondObject.x;firstObject.copyy=secondObject.y-secondObject.value;secondObject.value=secondObject.value+firstObject.value;clearInterval(intervalId);stage.animating--;stage.showArrow=stage.showArrow.concat([firstObject.x,firstObject.y-firstObject.value/2,secondObject.x,(secondObject.y-secondObject.value)+firstObject.value/2])}}}};inalan.Stage.prototype.stopCopyingAndComparing=function(){for(var index in this.visuItems){if(this.visuItems.hasOwnProperty(index)){var obj=this.visuItems[index];if(obj instanceof inalan.VisuVariable){if(obj.copy){obj.stopCopying()}if(obj.compare){obj.stopComparing()}}if(obj instanceof inalan.VisuArray){for(var i=0;i<obj.length;i++){if(obj[i].copy){obj[i].stopCopying()}if(obj[i].compare){obj[i].stopComparing()}}}}}};var inalan=inalan||{};inalan.Controller=function(){this.x=0;this.y=0;this.fncIndex=[0];this.stepFncsArray=null;this.playingAnimation=false;this.waitingAnimation=false;this.nextStepAuto=-1;this.singleStep=false;this.undo=[];var self=this;this.resetLabel="Reset";this.startLabel="Play";this.stopLabel="Stop";this.prevLabel="◄◄";this.prevSingleLabel="◄";this.nextSingleLabel="►";this.nextLabel="►►";this.speedLabel="Speed of animation:";var restoreStepFromUndo=function(stepNumber){var stage=self.ctx.canvas.parent;var copyAttributes=function(obj1,obj2){for(var i in obj1){if(typeof(obj1[i])==="object"){if(obj1[i] instanceof Array){obj2[i]=obj1[i]}else{if(!obj2.hasOwnProperty(i)){obj2[i]={}}copyAttributes(obj1[i],obj2[i])}}else{obj2[i]=obj1[i]}}};var deleteAttributes=function(obj1,obj2){for(var i in obj2){if(typeof(obj2[i])==="object"&&obj1.hasOwnProperty(i)){deleteAttributes(obj1[i],obj2[i])}else{if(!obj1.hasOwnProperty(i)){delete obj2[i]}}}};var vars=JSON.parse(self.undo[stepNumber][1]);copyAttributes(vars,stage.vars);deleteAttributes(vars,stage.vars);var visuItems=JSON.parse(self.undo[stepNumber][2]);copyAttributes(visuItems,stage.visuItems);deleteAttributes(visuItems,stage.visuItems);self.fncIndex=JSON.parse(self.undo[stepNumber][3]);stage.showArrow=JSON.parse(self.undo[stepNumber][4]);stage.showBendedArrow=JSON.parse(self.undo[stepNumber][5]);stage.showDoubleArrow=JSON.parse(self.undo[stepNumber][6]);self.nextStepAuto=self.undo[stepNumber][7]};var resetAnimationWhenPossible=false;var resetAnimation=function(){var stage=self.ctx.canvas.parent;if(stage.animating==0&&!self.waitingAnimation){resetAnimationWhenPossible=false;self.playingAnimation=false;self.nextStepAuto=-1;self.startStop.text=self.startLabel;restoreStepFromUndo(0);self.undo=[];self.reset.enabled=false;self.startStop.enabled=true;self.prevSingleStep.enabled=false;self.nextSingleStep.enabled=true;self.prevStep.enabled=false;self.nextStep.enabled=true}else{if(stage.animating>0||self.waitingAnimation){resetAnimationWhenPossible=true}}};var prevStepAnimation=function(){var stage=self.ctx.canvas.parent;if(stage.animating==0&&!self.waitingAnimation){var i=self.undo.length-1;if(!self.singleStep){while(self.undo[i][7]>0){i--}}restoreStepFromUndo(i);self.undo=self.undo.slice(0,i);if(self.undo.length==0){self.reset.enabled=false;self.prevSingleStep.enabled=false;self.prevStep.enabled=false}self.startStop.enabled=true;self.nextSingleStep.enabled=true;self.nextStep.enabled=true}};var startStopAnimation=function(){var stage=self.ctx.canvas.parent;self.singleStep=false;if(!self.playingAnimation){self.playingAnimation=true;self.startStop.text=self.stopLabel;self.prevSingleStep.enabled=false;self.nextSingleStep.enabled=false;self.prevStep.enabled=false;self.nextStep.enabled=false;if(stage.animating==0){nextStepAnimation()}}else{self.playingAnimation=false;self.startStop.text=self.startLabel;if(self.undo.length>0){self.prevSingleStep.enabled=true;self.prevStep.enabled=true}self.nextSingleStep.enabled=true;self.nextStep.enabled=true}};var waitAnimationDone=function(){self.waitingAnimation=false;if(resetAnimationWhenPossible){resetAnimation()}else{if(self.playingAnimation||self.nextStepAuto>0){nextStepAnimation()}}};var nextStepAnimationDoneID;var nextStepAnimationDone=function(){var stage=self.ctx.canvas.parent;if(stage.animating==0&&!self.waitingAnimation){clearInterval(nextStepAnimationDoneID);if(resetAnimationWhenPossible){resetAnimation()}else{if(self.nextStepAuto==0){nextStepAnimation()}else{if(self.nextStepAuto>0&&!self.singleStep){self.waitingAnimation=true;setTimeout(waitAnimationDone,stage.time/1000*self.nextStepAuto)}else{if(self.playingAnimation){self.waitingAnimation=true;setTimeout(waitAnimationDone,stage.time)}}}}}};var nextStepAnimation=function(){var stage=self.ctx.canvas.parent;if(stage.animating==0&&!self.waitingAnimation&&self.stepFncsArray!=null){if(self.nextStepAuto!=0){self.reset.enabled=true;if(!self.playingAnimation){self.prevSingleStep.enabled=true;self.prevStep.enabled=true}var i=self.undo.length;self.undo[i]=new Array();self.undo[i][1]=JSON.stringify(stage.vars);self.undo[i][2]=JSON.stringify(stage.visuItems);self.undo[i][3]=JSON.stringify(self.fncIndex);self.undo[i][4]=JSON.stringify(stage.showArrow);self.undo[i][5]=JSON.stringify(stage.showBendedArrow);self.undo[i][6]=JSON.stringify(stage.showDoubleArrow);self.undo[i][7]=self.nextStepAuto}stage.showArrow=[];stage.showBendedArrow=[];stage.showDoubleArrow=[];stage.stopCopyingAndComparing();var i=0;var stepsArray=[self.stepFncsArray];var stepsCheck=[null];while(stepsArray[i][self.fncIndex[i]] instanceof Array){stepsCheck[i+1]=stepsArray[i][self.fncIndex[i]+1];stepsArray[i+1]=stepsArray[i][self.fncIndex[i]];i++;if(i>=self.fncIndex.length){self.fncIndex[i]=0}}self.nextStepAuto=stepsArray[i][self.fncIndex[i]]();if(typeof(self.nextStepAuto)=="undefined"){self.nextStepAuto=-1}var ok;do{ok=true;self.fncIndex[i]++;if(self.fncIndex[i]>=stepsArray[i].length){if(stepsCheck[i]!=null){if(stepsCheck[i]()){self.fncIndex[i]=0}else{i--;self.fncIndex[i]++;self.fncIndex=self.fncIndex.slice(0,i+1);ok=false}}else{self.nextStepAuto=-1;self.playingAnimation=false;if(self.undo.length>0){self.prevSingleStep.enabled=true;self.prevStep.enabled=true}self.nextSingleStep.enabled=false;self.nextStep.enabled=false;self.startStop.enabled=false;self.startStop.text=self.startLabel}}}while(!ok);nextStepAnimationDoneID=setInterval(nextStepAnimationDone,1)}};var changeSpeedOfAnimation=function(position){var stage=self.ctx.canvas.parent;stage.time=2000-position};var prevStep=function(){self.singleStep=false;prevStepAnimation()};var nextStep=function(){self.singleStep=false;nextStepAnimation()};var prevSingleStep=function(){self.singleStep=true;prevStepAnimation()};var nextSingleStep=function(){self.singleStep=true;nextStepAnimation()};this.reset=new inalan.VisuButton(this.resetLabel,70,resetAnimation);this.startStop=new inalan.VisuButton(this.startLabel,70,startStopAnimation);this.prevStep=new inalan.VisuButton(this.prevLabel,70,prevStep);this.prevSingleStep=new inalan.VisuButton(this.prevSingleLabel,0,prevSingleStep);this.nextSingleStep=new inalan.VisuButton(this.nextSingleLabel,0,nextSingleStep);this.nextStep=new inalan.VisuButton(this.nextLabel,70,nextStep);this.reset.enabled=false;this.prevStep.enabled=false;this.prevSingleStep.enabled=false;this.speed=new inalan.VisuScrollbar(this.speedLabel,150,200,1800,1000,changeSpeedOfAnimation)};inalan.Controller.prototype.showAllButtons=function(){this.reset.width=70;this.startStop.width=70;this.prevStep.width=70;this.prevSingleStep.width=70;this.nextSingleStep.width=70;this.nextStep.width=70;this.speed.width=150};inalan.Controller.prototype.render=function(){this.ctx.beginPath();this.ctx.strokeStyle="#000";this.ctx.moveTo(0,this.y-40+0.5);this.ctx.lineTo(this.ctx.canvas.clientWidth,this.y-40+0.5);this.ctx.stroke();var spaceWidth=0;if(this.reset.width>0){this.reset.ctx=this.ctx;this.reset.x=this.x+this.reset.width/2;this.reset.y=this.y;this.reset.render();spaceWidth+=20}if(this.startStop.width>0){this.startStop.ctx=this.ctx;this.startStop.x=this.x+this.reset.width+this.startStop.width/2+spaceWidth;this.startStop.y=this.y;this.startStop.render();spaceWidth+=20}if(this.prevStep.width>0){this.prevStep.ctx=this.ctx;this.prevStep.x=this.x+this.reset.width+this.startStop.width+this.prevStep.width/2+spaceWidth;this.prevStep.y=this.y;this.prevStep.render()}if(this.prevSingleStep.width>0){this.prevSingleStep.ctx=this.ctx;this.prevSingleStep.x=this.x+this.reset.width+this.startStop.width+this.prevStep.width+this.prevSingleStep.width/2+spaceWidth;this.prevSingleStep.y=this.y;this.prevSingleStep.render()}if(this.nextSingleStep.width>0){this.nextSingleStep.ctx=this.ctx;this.nextSingleStep.x=this.x+this.reset.width+this.startStop.width+this.prevStep.width+this.prevSingleStep.width+this.nextSingleStep.width/2+spaceWidth;this.nextSingleStep.y=this.y;this.nextSingleStep.render()}if(this.nextStep.width>0){this.nextStep.ctx=this.ctx;this.nextStep.x=this.x+this.reset.width+this.startStop.width+this.prevStep.width+this.prevSingleStep.width+this.nextSingleStep.width+this.nextStep.width/2+spaceWidth;this.nextStep.y=this.y;this.nextStep.render()}if(this.speed.width>0){spaceWidth+=30;this.speed.ctx=this.ctx;this.speed.x=this.x+this.reset.width+this.startStop.width+this.prevStep.width+this.prevSingleStep.width+this.nextSingleStep.width+this.nextStep.width+this.speed.width/2+spaceWidth;this.speed.y=this.y;this.speed.render()}};inalan.Controller.prototype.setSteps=function(stepsFncsArray){this.stepFncsArray=stepsFncsArray};var inalan=inalan||{};inalan.VisuData=function(){this.x=0;this.y=0};var inalan=inalan||{};inalan.VisuVariable=function(name,value,changeable){if(typeof(changeable)=="undefined"){changeable=false}inalan.VisuData.call(this);this.name=name;if(value<0){throw"- the value of '"+name+"' must be >= 0"}this.value=value;this.minValue=0;this.maxValue=value>180?value:180;this.height=this.maxValue;this.fillColor="#C00";this.strokeColor="#000";this.width=24;this.textRotation=0;this.changeable=changeable;this.dragging=false;this.copy=false;this.copyx=0;this.copyy=0;this.compare=false;this.defaultColor="#C00";this.yellowColor="#FF2";this.lightYellowColor="#FFD";this.greenColor="#090";this.grayColor="#CCC";this.hiddenColor="#EEE";this.originalFillColor="#C00";this.originalStrokeColor="#000"};inalan.VisuVariable.prototype=Object.create(inalan.VisuData.prototype);inalan.VisuVariable.prototype.constructor=inalan.VisuVariable;inalan.VisuVariable.prototype.randomize=function(min,max){if(typeof(min)=="undefined"||min<this.minValue){min=this.minValue}if(typeof(max)=="undefined"||max>this.maxValue){max=this.maxValue}this.value=Math.floor((Math.random()*(max-min+1))+min)};inalan.VisuVariable.prototype.render=function(){if(this.value<0){this.value=0}if(this.minValue<0){this.minValue=0}if(this.value>this.maxValue){this.value=this.maxValue}else{if(this.value<this.minValue){this.value=this.minValue}}if(this.maxValue>this.height){this.height=this.maxValue}this.ctx.fillStyle=this.hiddenColor;this.ctx.fillRect(this.x-this.width/2-1,this.y-this.height-1,this.width+1,this.height);this.ctx.fillStyle=this.fillColor;this.ctx.fillRect(this.x-this.width/2-0.5,this.y-this.value-0.5,this.width,this.value);this.ctx.strokeStyle=this.strokeColor;this.ctx.strokeRect(this.x-this.width/2-0.5,this.y-0.5-this.value,this.width,this.value);this.ctx.strokeStyle="#000";this.ctx.beginPath();this.ctx.moveTo(this.x-this.width/2-3,this.y-0.5);this.ctx.lineTo(this.x-this.width/2+this.width+2,this.y-0.5);this.ctx.stroke();if(this.changeable){this.ctx.strokeStyle="#BBB";this.ctx.beginPath();this.ctx.moveTo(this.x-this.width/5,this.y-0.5-this.value-3);this.ctx.lineTo(this.x,this.y-0.5-this.value-6);this.ctx.lineTo(this.x+this.width/5,this.y-0.5-this.value-3);this.ctx.moveTo(this.x,this.y-0.5-this.value-6);this.ctx.lineTo(this.x,this.y-0.5-this.value-2);this.ctx.stroke();if(this.value>6){var r=parseInt(this.fillColor.substring(1,2),16)-3;var g=parseInt(this.fillColor.substring(2,3),16)-3;var b=parseInt(this.fillColor.substring(3,4),16)-3;if(r<0){r=0}if(g<0){g=0}if(b<0){b=0}this.ctx.strokeStyle="#"+r.toString(16)+g.toString(16)+b.toString(16);this.ctx.beginPath();this.ctx.moveTo(this.x-this.width/5,this.y-0.5-this.value+3);this.ctx.lineTo(this.x,this.y-0.5-this.value+6);this.ctx.lineTo(this.x+this.width/5,this.y-0.5-this.value+3);this.ctx.moveTo(this.x,this.y-0.5-this.value+6);this.ctx.lineTo(this.x,this.y-0.5-this.value+2);this.ctx.stroke()}}if(this.compare){this.ctx.fillStyle="#055";this.ctx.globalAlpha=0.1;if(this.value>30){this.ctx.font="bold 26px Comic Sans MS"}else{this.ctx.font="bold "+(this.value-4)+"px Comic Sans MS"}this.ctx.textAlign="center";this.ctx.textBaseline="middle";this.ctx.fillText("?",this.x,this.y-this.value/2);this.ctx.globalAlpha=1}this.ctx.fillStyle="#000";this.ctx.font="12px Arial";this.ctx.textBaseline="alphabetic";if(this.textRotation==0){this.ctx.textAlign="center";this.ctx.fillText(this.name,this.x-0.5,this.y+13.5)}else{this.ctx.save();this.ctx.translate(this.x-0.5,this.y+13.5);this.ctx.rotate(-Math.PI/180*this.textRotation);this.ctx.textAlign="right";this.ctx.fillText(this.name,7,3);this.ctx.restore()}};inalan.VisuVariable.prototype.renderCopy=function(){if(this.copy){this.ctx.fillStyle=this.yellowColor;this.ctx.fillRect(this.copyx-this.width/2-0.5,this.copyy-this.value-0.5,this.width,this.value);this.ctx.strokeStyle="#000";this.ctx.strokeRect(this.copyx-this.width/2-0.5,this.copyy-0.5-this.value,this.width,this.value)}};inalan.VisuVariable.prototype.isOver=function(x,y){if(Math.abs(x-this.x)<this.width/2&&Math.abs(y-(this.y-this.value))<=5){return true}return false};inalan.VisuVariable.prototype.setHeight=function(height){this.height=height;if(this.maxValue>this.height){this.maxValue=this.height}if(this.value>this.maxValue){this.value=this.maxValue}};inalan.VisuVariable.prototype.startCopying=function(){this.copyx=this.x;this.copyy=this.y;this.originalFillColor=this.fillColor;this.originalStrokeColor=this.strokeColor;this.copy=true};inalan.VisuVariable.prototype.stopCopying=function(){if(this.copy){this.fillColor=this.originalFillColor;this.strokeColor=this.originalStrokeColor;this.copy=false}};inalan.VisuVariable.prototype.startComparing=function(){this.originalFillColor=this.fillColor;this.originalStrokeColor=this.strokeColor;this.fillColor=this.yellowColor;this.strokeColor="#000";this.compare=true};inalan.VisuVariable.prototype.stopComparing=function(){if(this.compare){this.fillColor=this.originalFillColor;this.strokeColor=this.originalStrokeColor;this.compare=false;this.changeable=false}};inalan.VisuVariable.prototype.setDefaultColor=function(){this.fillColor=this.defaultColor;this.strokeColor="#000"};inalan.VisuVariable.prototype.setYellowColor=function(){this.fillColor=this.yellowColor;this.strokeColor="#000"};inalan.VisuVariable.prototype.setLightYellowColor=function(){this.fillColor=this.lightYellowColor;this.strokeColor="#000"};inalan.VisuVariable.prototype.setGreenColor=function(){this.fillColor=this.greenColor;this.strokeColor="#000"};inalan.VisuVariable.prototype.setGrayColor=function(){this.fillColor=this.grayColor;this.strokeColor=this.grayColor};inalan.VisuVariable.prototype.setHiddenColor=function(){this.fillColor=this.hiddenColor;this.strokeColor=this.hiddenColor};var inalan=inalan||{};inalan.VisuArray=function(name,values,changeable){if(typeof(changeable)=="undefined"){changeable=false}inalan.VisuData.call(this);this.name=name;this.length=values.length;for(var i=0;i<values.length;i++){this[i]=new inalan.VisuVariable(name+"["+i+"]",values[i],changeable);this[i].textRotation=45}this.showIndexes=true;this.indexes={};this.loopMarks={};this.markers=[];this.indexesPos=0;this.indexStrokeColor="#CDD";this.indexFillColor="#DEE";this.loopMarkStrokeColor="#D8E8E8";this.loopMarkFillColor="#FAFAFA"};inalan.VisuArray.prototype=Object.create(inalan.VisuData.prototype);inalan.VisuArray.prototype.constructor=inalan.VisuArray;inalan.VisuArray.prototype.randomize=function(min,max){for(var i=0;i<this.length;i++){this[i].randomize(min,max)}};inalan.VisuArray.prototype.setIndex=function(name,value,pos){if(typeof(pos)=="undefined"){pos=-1}this.indexes[name]={value:value,pos:pos}};inalan.VisuArray.prototype.deleteIndex=function(name){delete (this.indexes[name]);delete (this.loopMarks[name])};inalan.VisuArray.prototype.deleteAllIndexes=function(){this.indexes={};this.loopMarks={}};inalan.VisuArray.prototype.setLoopMarker=function(indexName,from,to,backward){this.loopMarks[indexName]={from:from,to:to,backward:backward}};inalan.VisuArray.prototype.deleteLoopMarker=function(indexName){delete (this.loopMarks[indexName])};inalan.VisuArray.prototype.setMarker=function(from,to,color){var n=this.markers.length;var found=false;for(var i=0;i<n;i++){if(this.markers[i].from==from&&this.markers[i].to==to){found=true;this.markers[i].color=color}}if(!found){this.markers[n]={from:from,to:to,color:color}}};inalan.VisuArray.prototype.deleteMarker=function(from,to){var n=this.markers.length;var foundPlace=-1;for(var i=0;i<n;i++){if(this.markers[i].from==from&&this.markers[i].to==to){foundPlace=i}}if(foundPlace>=0){this.markers.splice(foundPlace,1)}};inalan.VisuArray.prototype.deleteAllMarkers=function(){this.markers=[]};inalan.VisuArray.prototype.render=function(){var maxHeight=this[0].height;for(var i=0;i<this.length;i++){if(this[i].height>maxHeight){maxHeight=this[i].height}}var xpos=this.x;if(this.showIndexes||Object.keys(this.indexes).length>0){this.ctx.fillStyle="#BBB";this.ctx.font="bold 12px Courier New";this.ctx.textAlign="center";this.ctx.textBaseline="alphabetic";for(var k=0;k<this.length;k++){this.ctx.fillText(k,this[k].x-0.5,this[k].y+50+this.indexesPos)}}for(var name in this.loopMarks){if(this.indexes.hasOwnProperty(name)){var pos=0;if(this.indexes[name].pos>=0){pos=this.indexes[name].pos}else{var fixIndexPos=[];for(var name2 in this.indexes){if(this.indexes[name].value==this.indexes[name2].value&&this.indexes[name].pos>=0){fixIndexPos=fixIndexPos.concat([this.indexes[name2].pos])}}for(var name2 in this.indexes){if(this.indexes[name].value==this.indexes[name2].value&&this.indexes[name].pos<0&&name>name2){while(fixIndexPos.indexOf(pos)>-1){pos++}fixIndexPos=fixIndexPos.concat([pos])}}while(fixIndexPos.indexOf(pos)>-1){pos++}}var X;var Y;if(this.loopMarks[name].from>=0&&this.loopMarks[name].from<this.length){X=this[this.loopMarks[name].from].x;Y=this[this.loopMarks[name].from].y+72+this.indexesPos-4+27*pos}else{if(this.loopMarks[name].from==-1){X=this[0].x-this[0].width-2;Y=this[0].y+72+this.indexesPos-4+27*pos}else{X=this[this.length-1].x+this[this.length-1].width+2;Y=this[this.length-1].y+72+this.indexesPos-4+27*pos}}var Xto;if(this.loopMarks[name].to>=0&&this.loopMarks[name].to<this.length){Xto=this[this.loopMarks[name].to].x}else{if(this.loopMarks[name].to==-1){Xto=this[0].x-this[0].width-2}else{Xto=this[this.length-1].x+this[this.length-1].width+2}}var width=Math.abs(X-Xto);var down=this.loopMarks[name].from>this.loopMarks[name].to;if(this.loopMarks[name].from==this.loopMarks[name].to){down=this.loopMarks[name].backward}if(down){X=Xto}this.ctx.strokeStyle=this.loopMarkStrokeColor;this.ctx.fillStyle=this.loopMarkFillColor;this.ctx.beginPath();this.ctx.rect(X-11,Y-7.5,width+22,16);this.ctx.fill();this.ctx.stroke();this.ctx.fillStyle=this.loopMarkStrokeColor;this.ctx.font="16px Comic Sans MS";this.ctx.textAlign="center";this.ctx.textBaseline="middle";var s=">";if(down){s="<"}while(this.ctx.measureText(s+" >").width<width+12){if(!down){s=s+" >"}else{s=s+" <"}}this.ctx.fillText(s,X+width/2,Y)}}var maxIndexPos=-1;for(var i=-1;i<=this.length;i++){if(i>=0&&i<this.length){this[i].ctx=this.ctx;this[i].x=xpos;if(i<this.length-1){xpos=xpos+this[i].width/2+this[i+1].width/2+2}this[i].y=this.y;this[i].height=maxHeight;this[i].render()}var fixIndexPos=[];for(var name in this.indexes){if(this.indexes[name].value==i&&this.indexes[name].pos>=0){fixIndexPos=fixIndexPos.concat([this.indexes[name].pos])}}var indexNames=[];for(var name in this.indexes){indexNames=indexNames.concat([name])}indexNames.sort();for(var j=0;j<indexNames.length;j++){if(this.indexes[indexNames[j]].value==i){var indexPos=this.indexesPos;if(this.indexes[indexNames[j]].pos>=0){indexPos=indexPos+27*this.indexes[indexNames[j]].pos}else{var k=0;while(fixIndexPos.indexOf(k)>-1){k++}fixIndexPos=fixIndexPos.concat([k]);indexPos=indexPos+27*k}this.ctx.strokeStyle=this.indexStrokeColor;this.ctx.fillStyle=this.indexFillColor;this.ctx.beginPath();if(i>=0&&i<this.length){this.ctx.arc(this[i].x,this[i].y+72+indexPos-4,11.5,0,2*Math.PI)}else{if(i==-1){this.ctx.arc(this[0].x-this[0].width-2,this[0].y+72+indexPos-4,11.5,0,2*Math.PI)}else{this.ctx.arc(this[this.length-1].x+this[this.length-1].width+2,this[0].y+72+indexPos-4,11.5,0,2*Math.PI)}}if(indexPos>maxIndexPos){maxIndexPos=indexPos}this.ctx.fill();this.ctx.stroke();this.ctx.fillStyle="#000";this.ctx.font="bold 12px Courier New";this.ctx.textAlign="center";this.ctx.textBaseline="alphabetic";if(i>=0&&i<this.length){this.ctx.fillText(indexNames[j],this[i].x-0.5,this[i].y+72+indexPos)}else{if(i==-1){this.ctx.fillText(indexNames[j],this[0].x-this[0].width-0.5-2,this[0].y+72+indexPos)}else{this.ctx.fillText(indexNames[j],this[this.length-1].x+this[this.length-1].width-0.5+2,this[0].y+72+indexPos)}}}}}var markerYPos;if(maxIndexPos==-1){markerYPos=this[0].y+55}else{markerYPos=this[0].y+55+maxIndexPos+27}var m=[];for(var i=-1;i<=this.length;i++){m[i]=0}for(var i=0;i<this.markers.length;i++){var max=0;for(var j=this.markers[i].from;j<=this.markers[i].to;j++){if(m[j]>max){max=m[j]}}for(var j=this.markers[i].from;j<=this.markers[i].to;j++){m[j]=max+1}}var maxMarkers=0;for(var i=-1;i<=this.length;i++){if(m[i]>maxMarkers){maxMarkers=m[i]}}for(var i=-1;i<=this.length;i++){m[i]=0}for(var i=0;i<this.markers.length;i++){var max=0;for(var j=this.markers[i].from;j<=this.markers[i].to;j++){if(m[j]>max){max=m[j]}}for(var j=this.markers[i].from;j<=this.markers[i].to;j++){m[j]=max+1}var markerX1Pos;if(this.markers[i].from>=0){markerX1Pos=this[this.markers[i].from].x-this[this.markers[i].from].width/2}else{markerX1Pos=this[this.markers[0].from].x-this[this.markers[0].from].width*1.5}var markerX2Pos;if(this.markers[i].to<this.length){markerX2Pos=this[this.markers[i].to].x+this[this.markers[i].to].width/2}else{markerX2Pos=this[this.markers[this.length-1].to].x+this[this.markers[this.length-1].to].width*1.5}this.ctx.strokeStyle=this.markers[i].color;this.ctx.beginPath();this.ctx.moveTo(markerX1Pos+0.5,markerYPos+(maxMarkers-max)*6-4);this.ctx.lineTo(markerX1Pos+0.5,markerYPos+(maxMarkers-max)*6);this.ctx.lineTo(markerX2Pos-0.5,markerYPos+(maxMarkers-max)*6);this.ctx.lineTo(markerX2Pos-0.5,markerYPos+(maxMarkers-max)*6-4);this.ctx.stroke()}};inalan.VisuArray.prototype.renderCopy=function(){for(var i=0;i<this.length;i++){this[i].renderCopy()}};inalan.VisuArray.prototype.setMinValue=function(value){for(var i=0;i<this.length;i++){this[i].minValue=value}};inalan.VisuArray.prototype.setMaxValue=function(value){for(var i=0;i<this.length;i++){this[i].maxValue=value}};inalan.VisuArray.prototype.setHeight=function(height){for(var i=0;i<this.length;i++){this[i].setHeight(height)}};var inalan=inalan||{};inalan.VisuButton=function(text,width,onClickFnc){inalan.VisuData.call(this);this.text=text;this.width=width;this.height=26;this.enabled=true;this.pressed=false;this.onClickFnc=onClickFnc;this.color="#FE6";this.font="bold 14px Arial";this.defaultColor="#FE6";this.overColor="#FB3";this.disabledColor="#EEE"};inalan.VisuButton.prototype=Object.create(inalan.VisuData.prototype);inalan.VisuButton.prototype.constructor=inalan.VisuButton;inalan.VisuButton.prototype.render=function(){if(this.width>0){if(this.enabled){this.ctx.fillStyle=this.color}else{this.ctx.fillStyle=this.disabledColor}this.ctx.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height);this.ctx.strokeStyle="#000";this.ctx.strokeRect(this.x-this.width/2-0.5,this.y-this.height/2-0.5,this.width+1,this.height+1);if(this.enabled){this.ctx.fillStyle="#000"}else{this.ctx.fillStyle="#666"}this.ctx.font=this.font;this.ctx.textAlign="center";this.ctx.textBaseline="alphabetic";this.ctx.fillText(this.text,this.x,this.y+4.5)}};inalan.VisuButton.prototype.isOver=function(x,y){if(this.width>0&&Math.abs(x-this.x)<=this.width/2&&Math.abs(y-this.y)<=this.height/2){return true}return false};var inalan=inalan||{};inalan.VisuScrollbar=function(text,width,min,max,position,onChangeFnc){inalan.VisuData.call(this);this.text=text;if(width<30){width=30}this.width=width;this.enabled=true;this.dragging=false;this.min=min;this.max=max;if(position<min){position=min}if(position>max){position=max}this.position=position;this.color="#FE6";this.defaultColor="#FE6";this.overColor="#FB3";this.disabledColor="#EEE";this.onChange=onChangeFnc};inalan.VisuScrollbar.prototype=Object.create(inalan.VisuData.prototype);inalan.VisuScrollbar.prototype.constructor=inalan.VisuScrollbar;inalan.VisuScrollbar.prototype.render=function(){this.ctx.strokeStyle="#000";this.ctx.beginPath();this.ctx.moveTo(this.x-this.width/2-0.5,this.y+0.5);this.ctx.lineTo(this.x+this.width/2+0.5,this.y+0.5);this.ctx.moveTo(this.x-this.width/2-0.5,this.y);this.ctx.lineTo(this.x+this.width/2+0.5,this.y);this.ctx.stroke();if(this.enabled){this.ctx.fillStyle=this.color}else{this.ctx.fillStyle=this.disabledColor}this.ctx.beginPath();var circleX=(this.x-this.width/2+10)+(this.position-this.min)*(this.width-20)/(this.max-this.min+1);var circleY=this.y;this.ctx.arc(circleX,circleY,10,0,2*Math.PI);this.ctx.fill();this.ctx.stroke();this.ctx.fillStyle="#000";this.ctx.font="13px Arial";this.ctx.textAlign="center";this.ctx.textBaseline="alphabetic";this.ctx.fillText(this.text,this.x,this.y-17)};inalan.VisuScrollbar.prototype.isOver=function(x,y){var circleX=(this.x-this.width/2+10)+(this.position-this.min)*(this.width-20)/(this.max-this.min+1);var circleY=this.y;if(Math.sqrt(Math.pow(circleX-x,2)+Math.pow(circleY-y,2))<=10){return true}return false};var inalan=inalan||{};inalan.VisuLabel=function(lines){inalan.VisuData.call(this);this.lines=lines};inalan.VisuLabel.prototype=Object.create(inalan.VisuData.prototype);inalan.VisuLabel.prototype.constructor=inalan.VisuLabel;inalan.VisuLabel.prototype.render=function(){this.ctx.fillStyle="#000";this.ctx.font="14px Arial";this.ctx.textAlign="left";this.ctx.textBaseline="top";for(var i=0;i<this.lines.length;i++){this.ctx.fillText(this.lines[i],this.x,this.y+i*18)}};var inalan=inalan||{};inalan.VisuCode=function(lines){inalan.VisuData.call(this);this.lines=lines;this.selected=[];this.selectionColor="#DEE";this.recBackColor="#EEE";this.rec=[];this.recBackSelection=null;this.recAnim=[]};inalan.VisuCode.prototype=Object.create(inalan.VisuData.prototype);inalan.VisuCode.prototype.constructor=inalan.VisuCode;inalan.VisuCode.prototype.render=function(){if(this.rec.length>0){for(var i=0;i<this.rec.length;i++){this.ctx.font="bold 16px Courier New";var maxWidth=0;for(var j=0;j<this.rec[i].lines.length;j++){if(this.ctx.measureText(this.rec[i].lines[j]).width>maxWidth){maxWidth=this.ctx.measureText(this.rec[i].lines[j]).width}}if(i>0){this.ctx.fillStyle="#FFF";this.ctx.strokeStyle="#000";this.ctx.beginPath();this.ctx.rect(this.rec[i].x,this.rec[i].y-10,maxWidth+40,this.rec[i].lines.length*22-2+20);this.ctx.stroke();this.ctx.fill()}this.ctx.fillStyle="#EEE";this.ctx.textAlign="left";this.ctx.textBaseline="top";for(var j=0;j<this.rec[i].lines.length;j++){this.ctx.fillText(this.rec[i].lines[j],this.rec[i].x+20,this.rec[i].y+1+j*22)}}}this.ctx.font="bold 16px Courier New";var maxWidth=0;for(var i=0;i<this.lines.length;i++){if(this.ctx.measureText(this.lines[i]).width>maxWidth){maxWidth=this.ctx.measureText(this.lines[i]).width}}if(this.rec.length>0){this.ctx.fillStyle="#FFF";this.ctx.strokeStyle="#000";this.ctx.beginPath();this.ctx.rect(this.x,this.y-10,maxWidth+40,this.lines.length*22-2+20);this.ctx.stroke();this.ctx.fill()}if(this.recBackSelection==this.selected[0]){this.ctx.fillStyle=this.recBackColor}else{this.ctx.fillStyle=this.selectionColor;this.recBackSelection=null}for(var i in this.selected){this.ctx.fillRect(this.x,this.y+this.selected[i]*22,maxWidth+40,20)}this.ctx.fillStyle="#000";this.ctx.textAlign="left";this.ctx.textBaseline="top";for(var i=0;i<this.lines.length;i++){this.ctx.fillText(this.lines[i],this.x+20,this.y+1+i*22)}if(this.recAnim.length>0){this.ctx.fillStyle="#FFF";this.ctx.strokeStyle="#000";this.ctx.beginPath();this.ctx.rect(this.recAnim[0],this.recAnim[1]-10,this.recAnim[2],this.recAnim[3]-2+20);this.ctx.stroke();this.ctx.fill();var lineSpace=(this.recAnim[3]-22)/(this.recAnim[4].length-1);this.ctx.globalAlpha=lineSpace/22;this.ctx.font="bold 16px Courier New";this.ctx.fillStyle="#000";this.ctx.textAlign="left";this.ctx.textBaseline="top";for(var i=0;i<this.recAnim[4].length;i++){this.ctx.fillText(this.recAnim[4][i],this.recAnim[0]+20,this.recAnim[1]+1+i*lineSpace)}this.ctx.globalAlpha=1}};inalan.VisuCode.prototype.functionCall=function(newLines){if(typeof(newLines)=="undefined"){newLines=this.lines.slice()}var stage=this.ctx.canvas.parent;stage.animating++;var frames=stage.fps*stage.time/1000;this.ctx.font="bold 16px Courier New";var maxWidth=0;for(var i=0;i<this.lines.length;i++){if(this.ctx.measureText(this.lines[i]).width>maxWidth){maxWidth=this.ctx.measureText(this.lines[i]).width}}this.ctx.font="bold 16px Courier New";var newMaxWidth=0;for(var i=0;i<newLines.length;i++){if(this.ctx.measureText(newLines[i]).width>newMaxWidth){newMaxWidth=this.ctx.measureText(newLines[i]).width}}this.recAnim=[this.x,this.y+this.selected[0]*22,maxWidth+40,22,newLines];var endX=this.x+3;var endY=this.y+3;var endWidth=newMaxWidth+40;var endHeight=newLines.length*22;var dX=(endX-this.recAnim[0])/frames;var dY=(endY-this.recAnim[1])/frames;var dWidth=(endWidth-this.recAnim[2])/frames;var dHeight=(endHeight-this.recAnim[3])/frames;var pauseFrames=stage.time/100;frames+=pauseFrames;var self=this;var recursionAnim=function(){frames--;if(frames>=pauseFrames){self.recAnim[0]+=dX;self.recAnim[1]+=dY;self.recAnim[2]+=dWidth;self.recAnim[3]+=dHeight}else{if(frames>0){self.recAnim[0]=endX;self.recAnim[1]=endY;self.recAnim[2]=endWidth;self.recAnim[3]=endHeight}else{clearInterval(intervalId);var n=self.rec.length;self.rec[n]={x:self.x,y:self.y,lines:self.lines.slice(),selected:self.selected.slice()};self.x=endX;self.y=endY;self.lines=newLines;self.selected=[];self.recAnim=[];stage.animating--}}};var intervalId=setInterval(recursionAnim,1000/stage.fps)};inalan.VisuCode.prototype.functionReturn=function(){var oldLines=this.lines.slice();var n=this.rec.length-1;this.x=this.rec[n].x;this.y=this.rec[n].y;this.lines=this.rec[n].lines.slice();this.selected=this.rec[n].selected.slice();this.rec=this.rec.slice(0,n);var stage=this.ctx.canvas.parent;stage.animating++;var frames=stage.fps*stage.time/1000;this.ctx.font="bold 16px Courier New";var maxWidth=0;for(var i=0;i<this.lines.length;i++){if(this.ctx.measureText(this.lines[i]).width>maxWidth){maxWidth=this.ctx.measureText(this.lines[i]).width}}this.ctx.font="bold 16px Courier New";var oldMaxWidth=0;for(var i=0;i<oldLines.length;i++){if(this.ctx.measureText(oldLines[i]).width>oldMaxWidth){oldMaxWidth=this.ctx.measureText(oldLines[i]).width}}this.recAnim=[this.x+3,this.y+3,oldMaxWidth+40,oldLines.length*22,oldLines];var endX=this.x;var endY=this.y+this.selected[0]*22;var endWidth=maxWidth+40;var endHeight=22;var dX=(this.recAnim[0]-endX)/frames;var dY=(this.recAnim[1]-endY)/frames;var dWidth=(this.recAnim[2]-endWidth)/frames;var dHeight=(this.recAnim[3]-endHeight)/frames;var self=this;var recursionAnim=function(){frames--;if(frames>0){self.recAnim[0]-=dX;self.recAnim[1]-=dY;self.recAnim[2]-=dWidth;self.recAnim[3]-=dHeight}else{clearInterval(intervalId);self.recAnim=[];self.recBackSelection=self.selected[0];stage.animating--}};var intervalId=setInterval(recursionAnim,1000/stage.fps)};